@if (TempData["MensagemErro"] != null)
{
    <div class="alert alert-danger" style="text-align: center;">
        @Html.Raw(TempData["MensagemErro"].ToString().Replace("\n", "<br/>"))
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["MensagemSucesso"] != null)
{
    <div class="alert alert-success" style="text-align: center;">
        @Html.Raw(TempData["MensagemSucesso"])
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (ViewBag.HorarioAdministrador != null && ViewBag.HorarioAdministrador.Count > 0)
{
    <h1 style="text-align: center; padding-bottom: 10px;">FILTRAR HORÁRIOS</h1>
    <div style="flex-direction: row;">
         <div class="dropdown">
            <div class="form-group">
                <label for="centroAtendimentoSelect">Centro de Atendimento:</label>
                <select class="form-control" id="centroAtendimentoSelect">
                    <option value="">Selecione um Centro de Atendimento</option>
                    @foreach (var centroAtendimento in ViewBag.CentroAtendimento)
                    {
                        <option value="@centroAtendimento.idCentroAtendimento">@centroAtendimento.nmCentroAtendimento</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label for="especialidadeSelect">Especialidade:</label>
                <select class="form-control" id="especialidadeSelect">
                    <option value="">Selecione uma Especialidade</option>
                </select>
            </div>

            <div class="form-group">
                <label for="servicoSelect">Serviço:</label>
                <select class="form-control" id="servicoSelect">
                    <option value="">Selecione um Serviço</option>
                </select>
            </div>
         </div>
    </div>

    <div class="form-group">
        <label>Nome do usuário:</label>
        <input type="text" class="form-control" placeholder="Insira o nome da pessoa">
    </div>

    <h1 style="text-align: center; padding-bottom: 10px;">HÓRARIOS MARCADOS</h1>
    <div class="cards-container">
        @foreach (var horario in ViewBag.HorarioAdministrador)
        {
            <div class="card-horizontal">
                <div class="card-section">
                    <p><strong>Nome:</strong> @horario.nmPessoa</p>
                    <p><strong>Serviço:</strong> @horario.nmServico</p>
                    <p><strong>Especialidade:</strong> @horario.nmEspecialidade</p>
                </div>
                <div class="card-section">
                    <p><strong>Telefone:</strong> @horario.nuTelefone</p>
                    <p><strong>Centro de Atendimento:</strong> @horario.nmCentroAtendimento</p>
                    <p><strong>Unidade de Atendimento:</strong> Clínica-Escola de Nutrição - Edifício União - SCS</p>
                </div>
                <div class="card-section">
                    <p><strong>Email:</strong> @horario.edEmail</p>
                    <p><strong>Data do Agendamento:</strong> @horario.dtAgenda.ToString("dd/MM/yyyy")</p>
                    <p><strong>Horário Início:</strong> @horario.hrInicio</p>
                    <p><strong>Horário Fim:</strong> @horario.hrFim</p>
                </div>
                <div></div>
                <div class="button-container">
                    <button class="btn btn-primary button-imprimir">Imprimir</button>
                    <form asp-controller="CentroAtendimento" asp-action="CancelarHorarioADM" method="post" class="button-form">
                        <input type="hidden" name="idAgendamento" value="@horario.idAgendamento" />
                        <button class="btn btn-primary button-cancelar" type="submit">Cancelar</button>
                    </form>
                </div>

            </div>
        }
    </div>
}
else
{
    <h1 style="text-align: center;">NÃO HÁ NENHUM HORÁRIO MARCADO.</h1>
}

<script>

    $(document).ready(function () {
        $('#centroAtendimentoSelect').change(function () {
            var idCentroAtendimento = $(this).val();
            atualizarEspecialidades(idCentroAtendimento);
        });

        $('#especialidadeSelect').change(function () {
            var idCentroAtendimento = $('#centroAtendimentoSelect').val();
            var idEspecialidade = $(this).val();
            atualizarServicos(idCentroAtendimento, idEspecialidade);
        });
    });

    function atualizarEspecialidades(idCentroAtendimento) {
        if (idCentroAtendimento) {
            $.getJSON('/CentroAtendimento/GetEspecialidadesPorCentro', { idCentroAtendimento: idCentroAtendimento }, function (data) {
                var especialidadeSelect = $('#especialidadeSelect');
                especialidadeSelect.empty();
                especialidadeSelect.append($('<option>', { value: '', text: 'Selecione uma Especialidade' }));
                $.each(data, function (index, item) {
                    especialidadeSelect.append($('<option>', { value: item.idEspecialidade, text: item.nmEspecialidade }));
                });
            });
        }
    }

    function atualizarServicos(idCentroAtendimento, idEspecialidade) {
        if (idCentroAtendimento && idEspecialidade) {
            $.getJSON('/CentroAtendimento/GetServicosFiltrados', { idCentroAtendimento: idCentroAtendimento, idEspecialidade: idEspecialidade }, function (data) {
                var servicoSelect = $('#servicoSelect');
                servicoSelect.empty();
                servicoSelect.append($('<option>', { value: '', text: 'Selecione um Serviço' }));
                $.each(data, function (index, item) {
                    servicoSelect.append($('<option>', { value: item.idServico, text: item.nmServico }));
                });
            });
        }
    }

</script>
